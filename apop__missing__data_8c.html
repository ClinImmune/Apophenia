<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html> <head>
     <title>Apophenia: a library for scientific computing</title>

<!-- Google is watching. -->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-134313-2";
urchinTracker();
</script>


     <link rel="stylesheet" href="typical.css" type="text/css" >
     <script  type="text/javascript" language="JavaScript" src="tree.js"></script>
</head><body>
     <center><table cellpadding=10pt>
     <tr> <td><img width=140px src=flake.gif alt="Patterns in static"></td> 
    <td><table>
     	<tr> <td><center><h2><a href="http://apophenia.info">Apophenia</a></h2></center></td></tr>
<tr><td><div class="qindex"><a class="qindex" href="index.html">&nbsp;Intro</a> | <a class="qindex" href="outline.html">Outline</a> | <a class="qindex" href="globals.html">Index</a> <!--| <a class="qindex" href="files.html">File&nbsp;List&nbsp;</a> -->  </div></td></tr></table>
	</td></tr></table></center>

<!-- Generated by Doxygen 1.7.4 -->
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">apop_missing_data.c File Reference</div>  </div>
</div>
<div class="contents">
<h2><a name="define-members"></a>
Defines</h2>
<ul>
<li><a class="anchor" id="aa7df3cba96c46eca7a4adc6567153ea5"></a><!-- doxytag: member="apop_missing_data.c::Switch_back" ref="aa7df3cba96c46eca7a4adc6567153ea5" args="" -->
#define <b>Switch_back</b>
<li>#define <b>apop_setup_one_colthing</b>(c)
</ul>
<h2><a name="typedef-members"></a>
Typedefs</h2>
<ul>
<li>typedef <a class="el" href="struct__apop__data.html">apop_data</a> *(* <a class="el" href="apop__missing__data_8c.html#a944d3a44f76c63d2bec667332ed7dbae">data_to_data</a> )(<a class="el" href="struct__apop__data.html">apop_data</a> *)
</ul>
<h2><a name="func-members"></a>
Functions</h2>
<ul>
<li><a class="anchor" id="adb52873568fd5cf5460f81af7e942448"></a><!-- doxytag: member="apop_missing_data.c::apop_predict_table_prep" ref="adb52873568fd5cf5460f81af7e942448" args="(apop_data *in, char fill_with_nans)" -->
<a class="el" href="struct__apop__data.html">apop_data</a> * <b>apop_predict_table_prep</b> (<a class="el" href="struct__apop__data.html">apop_data</a> *in, char fill_with_nans)
<li>void <a class="el" href="apop__missing__data_8c.html#a7983920ba996157fc4e636ac25d1d173">apop_data_predict_fill</a> (<a class="el" href="struct__apop__data.html">apop_data</a> *data, <a class="el" href="struct__apop__data.html">apop_data</a> *predict)
<li><a class="el" href="struct__apop__data.html">apop_data</a> * <a class="el" href="apop__missing__data_8c.html#a0316d98bbeb6ae13532a8c071019dbe6">apop_data_listwise_delete</a> (<a class="el" href="struct__apop__data.html">apop_data</a> *d, char inplace)
<li><a class="el" href="struct__apop__model.html">apop_model</a> * <a class="el" href="apop__missing__data_8c.html#a985955429db179a45eb5936ebd324760">apop_ml_impute</a> (<a class="el" href="struct__apop__data.html">apop_data</a> *d, <a class="el" href="struct__apop__model.html">apop_model</a> *mvn)
<li><a class="anchor" id="aa90594cd0b3c12395cda5235f086e167"></a><!-- doxytag: member="apop_missing_data.c::apop_multiple_imputation_variance" ref="aa90594cd0b3c12395cda5235f086e167" args="(apop_data *base_data, apop_data *fill_ins, data_to_data stat, char *row_name, char *col_name, char *value_name, char *imputation_name)" -->
<a class="el" href="struct__apop__data.html">apop_data</a> * <b>apop_multiple_imputation_variance</b> (<a class="el" href="struct__apop__data.html">apop_data</a> *base_data, <a class="el" href="struct__apop__data.html">apop_data</a> *fill_ins, <a class="el" href="apop__missing__data_8c.html#a944d3a44f76c63d2bec667332ed7dbae">data_to_data</a> stat, char *row_name, char *col_name, char *value_name, char *imputation_name)
</ul>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Some missing data handlers. </p>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="ae8f8b1df71819b4b5231b0caac8c0276"></a><!-- doxytag: member="apop_missing_data.c::apop_setup_one_colthing" ref="ae8f8b1df71819b4b5231b0caac8c0276" args="(c)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define apop_setup_one_colthing</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">c</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment"><span class="keywordtype">int</span> c##col = <a class="code" href="apop__name_8c.html#a6c71f6c23090592a291fc878c8836120">apop_name_find</a>(fill_ins-&gt;names, c##_name, <span class="charliteral">&#39;c&#39;</span>);   \
    <span class="keywordtype">int</span> c##type = <span class="charliteral">&#39;d&#39;</span>;         \
    <span class="keywordflow">if</span> (c##col==-2){           \
        c##col = <a class="code" href="apop__name_8c.html#a6c71f6c23090592a291fc878c8836120">apop_name_find</a>(fill_ins-&gt;names, c##_name, <span class="charliteral">&#39;t&#39;</span>);   \
        c##type = <span class="charliteral">&#39;t&#39;</span>;         \
       <a class="code" href="asst_8h.html#aa6760fa3f2e261b93aaf25d80a11375c">Apop_assert</a>(c##col!=-2, <span class="stringliteral">&quot;I couldn&#39;t find the c##_name %s in the column/text names of your fill_in table.&quot;</span>, c##_name);    \
    }
</pre></div>
</div>
</div>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="a944d3a44f76c63d2bec667332ed7dbae"></a><!-- doxytag: member="apop_missing_data.c::data_to_data" ref="a944d3a44f76c63d2bec667332ed7dbae" args=")(apop_data *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="struct__apop__data.html">apop_data</a>*(* <a class="el" href="apop__missing__data_8c.html#a944d3a44f76c63d2bec667332ed7dbae">data_to_data</a>)(<a class="el" href="struct__apop__data.html">apop_data</a> *)</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Imputation (in this context) is the process of finding fill-in values for missing data points. Filling in values from a single imputation and then returning the values will give you a single complete data set, but statistics you derive from that data set don't reflect the uncertainty inherent in using artifical, model-derived data rather than actual observations. This function uses several imputations and a statistic-calculating function you provide to find the total variance (see details below).</p>
<p>The multiple imputation process involves two steps:</p>
<ul>
<li>Generating imputations via a model of your choosing, and writing down the results in a <code>fill_ins</code> table, described in the parameter list. You've already done this by the time you call this function.</li>
</ul>
<ul>
<li>For a given complete data set, generating a summary statistic, such as the mean of a column, or the ratio of columns one and two; plus the variance of your statistic(s).</li>
</ul>
<p>This function takes the output from the first step (a list of fill-ins), and uses it to calculate a list of statistics/variances, as per the second step. After generating this list of statistics/variances, it ties them together to produce a single best estimate of the statistic and its full variance.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">stat</td><td>A function that takes in a single <a class="el" href="gentle.html#apop_data">apop_data</a> set, and calculates statistics and their covariances. The output should have two pages. The first will be the statistics themselves; the second will be the covariance matrix. If I find a page with the name <code>&lt;Covariance&gt;</code> then I will use that; else the second page. This rule means you can return the <code>parameters</code> from most estimated models. Default: a function to find the per-column mean and the sample covariance matrix.</td></tr>
    <tr><td class="paramname">base_data</td><td>The data, with <code>NaNs</code> to be filled in. When calculating the statistics, I fill in the values in the <code>base_data</code> set directly, so it is modified, and in the end will have the value of the last replication.</td></tr>
    <tr><td class="paramname">fill_ins</td><td>This is the list of values to fill in to the base data set, and it must be an <a class="el" href="gentle.html#apop_data">apop_data</a> set whose matrix includes the following two column names toward the beginning: <code>row</code> and <code>col</code>, with an optional <code>page</code>. Every column after those two or three columns is taken to be an imputation that can be used to fill in values. That is, I will first take the first column after the row/col/page column and plug its values into the corresponding row/col/pages of <code>base_data</code>, calculate the variances, then repeat with the second column, and so on.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The first page is the mean of each replicate's statistics; the second page is the overall covariance (and will have the page title <code>&lt;Covariance&gt;</code>). Let <img class="formulaInl" alt="$S_i$" src="form_28.png"/> be the covariance for each replicate <img class="formulaInl" alt="$i$" src="form_29.png"/>; let there be <img class="formulaInl" alt="$m$" src="form_30.png"/> replicates; let <img class="formulaInl" alt="$\mu(\cdot)$" src="form_31.png"/> indicate the mean; then the overall covariance is the mean of the individual variances plus</dd></dl>
<p><img class="formulaInl" alt="$\mu(S_i) + {\rm var}(S_i)/(1+1/m).$" src="form_32.png"/></p>
<ul>
<li>Multiple pages for input data are not yet implemented. </li>
</ul>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a0316d98bbeb6ae13532a8c071019dbe6"></a><!-- doxytag: member="apop_missing_data.c::apop_data_listwise_delete" ref="a0316d98bbeb6ae13532a8c071019dbe6" args="(apop_data *d, char inplace)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct__apop__data.html">apop_data</a>* apop_data_listwise_delete </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__apop__data.html">apop_data</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>inplace</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>If there is an NaN anywhere in the row of data (including the matrix, the vector, the weights, and the text) then delete the row from the data set.</p>
<ul>
<li>If every row has an NaN, then this returns <code>NULL</code>. </li>
<li>If <code>apop_opts.db_nan</code> is not <code>NULL</code>, then I will use that as a regular expression to check the text elements for bad data as well. </li>
<li>If <code>inplace</code> = 'y', then I'll free each element of the input data set and refill it with the pruned elements. I'll still take up (up to) twice the size of the data set in memory during the function. If every row has an NaN, then your <code>apop_data</code> set will have a lot of <code>NULL</code> elements. if <code>inplace</code> = 'n', then the original data set is left unmolested. </li>
<li>I only look at the first page of data (i.e. the <code>more</code> element is ignored). </li>
<li>This function uses the <a class="el" href="designated.html">Designated initializers</a> syntax for inputs.</li>
</ul>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">d</td><td>The data, with NaNs </td></tr>
    <tr><td class="paramname">inplace</td><td>If <code>'y'</code>, clear out the pointer-to-<a class="el" href="gentle.html#apop_data">apop_data</a> that you sent in and refill with the pruned data. If <code>'n'</code>, leave the set alone and return a new data set. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A (potentially shorter) copy of the data set, without NaNs. If <code>inplace=='y'</code>, redundant with the input. If the entire data set is cleared out, then this will be <code>NULL</code>. </dd></dl>

</div>
</div>
<a class="anchor" id="a7983920ba996157fc4e636ac25d1d173"></a><!-- doxytag: member="apop_missing_data.c::apop_data_predict_fill" ref="a7983920ba996157fc4e636ac25d1d173" args="(apop_data *data, apop_data *predict)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apop_data_predict_fill </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__apop__data.html">apop_data</a> *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct__apop__data.html">apop_data</a> *&#160;</td>
          <td class="paramname"><em>predict</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Take a <code>predict</code> table and set the entries in the data set to the given predicted value. Functions for prediction and imputation use this internally, and append to your data a <code>predict</code> table of the right form. For example, <code>apop_ml_impute</code> uses this internally.</p>
<p>I assume that the ordering of elements in the <code>predict</code> table include everything on the first page, then everything on the second, et cetera.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>The data set to be filled in. It should have a page named <code><img class="formulaInl" alt="$<$" src="form_26.png"/>predict</code> <img class="formulaInl" alt="$>$" src="form_27.png"/>. </td></tr>
    <tr><td class="paramname">predict</td><td>If your data set doesn't have a <code><img class="formulaInl" alt="$<$" src="form_26.png"/>predict</code> <img class="formulaInl" alt="$>$" src="form_27.png"/> page, then just provide one this way; else let this be <code>NULL</code>; </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a985955429db179a45eb5936ebd324760"></a><!-- doxytag: member="apop_missing_data.c::apop_ml_impute" ref="a985955429db179a45eb5936ebd324760" args="(apop_data *d, apop_model *mvn)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct__apop__model.html">apop_model</a>* apop_ml_impute </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__apop__data.html">apop_data</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct__apop__model.html">apop_model</a> *&#160;</td>
          <td class="paramname"><em>mvn</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Impute the most likely data points to replace NaNs in the data, and insert them into the given data. That is, the data set is modified in place.</p>
<p>How it works: this uses the machinery for <a class="el" href="stats_8h.html#ab4f6ca7e042ac7c09c3c01d29702a739">apop_model_fix_params</a>. The only difference is that this searches over the data space and takes the parameter space as fixed, while basic fix params model searches parameters and takes data as fixed. So this function just does the necessary data-parameter switching to make that happen.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">d</td><td>The data set. It comes in with NaNs and leaves entirely filled in. </td></tr>
    <tr><td class="paramname">mvn</td><td>A parametrized <a class="el" href="types_8h.html#aadd13f6aa6f5f17d48d9b7d2b606bdd4">apop_model</a> from which you expect the data was derived. if <code>NULL</code>, then I'll use the Multivariate Normal that best fits the data after listwise deletion.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>An estimated <code>apop_ml_impute_model</code>. Also, the data input will be filled in and ready to use. </dd></dl>

</div>
</div>
</div>
<p><p>
<div class="tiny">Autogenerated by doxygen on Fri Jan 27 2012.</div></body></html>
