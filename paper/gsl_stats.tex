\long\def\comment#1{}
\newif\iftwocol \twocolfalse
\newif\ifbook \booktrue
\documentclass[10pt,notitlepage, openany]{book}
%\usepackage[pdftex]{epsfig}
\usepackage{epsfig}
\usepackage{xspace, calc, needspace, array,natbib,graphicx,wrapfig, apop_wrap, oldtitlesec, listings,hyphenat,fixltx2e,amssymb,pifont,psfrag}
\usepackage{hhline} %load last
%\usepackage[LHE,T1]{fontenc}


%\usepackage{geometry}
%\geometry{paperwidth=6.8in, paperheight=9.0in, textheight=7.5in,tmargin=2cm}
%\usepackage[cam,width=8.5in, height=11.0in,center]{crop}

%\usepackage{mathbbol} %Sigma, blackboard  This never worked. See kludge below.
%\usepackage{bbold} %Sigma, blackboard
%\let\boldsig\Sigma
\usepackage{amsmath, amsfonts}  %for mathbb
\usepackage{bm}  %boldmath
%\let\boldsig\savedSigma
%\def\treesymbol{\maltese}
%\usepackage{stmaryd}\def\treesymbol{\curlyveeuparrow} %stmaryd
\usepackage{textcomp}\def\treesymbol{\textreferencemark\xspace} %textcomp
%\usepackage{amssymb} \def\treesymbol{\mbox{\boldmath$\between$}} 
%\usepackage{bbding} \def\treesymbol{\PlusThinCenterOpen} 
%\usepackage{marvosym} \def\treesymbol{\Aries} 

\hyphenation{Apo-phe-nia al-go-rithm}

\long\def\treemark{
\begin{wrapfigure}{r}[0cm]{0cm}
\Aries
\end{wrapfigure}
}

%equation boxes
\long\def\eqnbox#1{
\begin{center}
\fbox{
\parbox{10cm}{
\begin{eqnarray}
#1
\end{eqnarray}
}
}
\end{center}
%\endonecol
}

\long\def\wideeqnbox#1#2{
\begin{center}
\fbox{
\parbox{#1}{
\begin{eqnarray}
#2
\end{eqnarray}
}
}
\end{center}
%\endonecol
}



%math conveniences, primarily commonly boldfaced vectors.
\bmdefine\bhat{\hat}
\def\that{$\bhat{\phantom{x}}$}
\bmdefine\bbackslash{\backslash}
\def\textbs{$\bbackslash$}
\def\xv{{\bf x} } \def\yv{{\bf y} } \def\pv{{\bf p} }
\def\Iv{{\bf I}}\def\Sv{{\bf S}}\def\zv{{\bf z}}\def\Zv{{\bf Z}} \def\cv{{\bf c}} \def\uv{{\bf u}} \def\Yv{{\bf Y}} \def\Xv{{\bf X}} \def\Qv{{\bf Q}}
\def\betav{{\mbox{\boldmath$\beta$}}}
\def\Xuv{\underbar{\bf X}}
%\def\vector#1{\left[\matrix{#1}\right]}
\def\vector#1{\left[\begin{matrix}#1\end{matrix}\right]}
\def\Re{{\mathbb{R}}}

%\def\var{\hbox{var}} \def\cov{\hbox{cov}}
%AMS version:
\DeclareMathOperator{\var}{var}
\DeclareMathOperator{\cov}{cov}

%Chapter and section headings. 
%uses the awrap style, included in this dir.
%\renewcommand\chaptername{} 
\titleformat{\part}[frame]{\Large\scshape}{\thepart}{.5em}{\thispagestyle{empty}}{}
\titleformat{\chapter}[frame]{\Large\scshape}{\thechapter}{.5em}{\scalebox{0.2}{\includegraphics{flake}}\\\hfill}{} %\flushright almost works.
\titlespacing{\section}{8cm}{1 cm}{-0.5 cm}
\titlespacing{\subsection}{8cm}{0.5 cm}{-0.5 cm}
\titleformat{\section}[awrap]{\large\bf\scshape}{\thesection}{1 em}{}{}
\titleformat{\subsection}[awrap]{\bf\scshape}{}{1 em}{}{}



%indexing:
\usepackage{multicol, makeidx, url}
%\usepackage[left=1.3in, right=1in,top=1in,bottom=1in]{geometry}
\makeindex
\def\cindx#1#2{\index{#1@\cinlinetwo{#1}|#2}}
\def\cindwsubhead#1#2{\index{\cinlinetwo{#1}!#2}}
\def\indwcsub#1#2{\index{#1!\cinlinetwo{#2}}}
\def\bindx#1#2{\index{#1@\binlinetwo{#1}|#2}}
\def\ind#1{\index{#1}#1}
\def\ttind#1{\index{#1@\cinlinetwo{#1}}\cinline{#1}}
%\def\cind#1{\index{#1@\cinlinetwo{#1}}\cinline{#1}}
\def\cindex#1{\cindx{#1}{}}
\def\bind#1{\bindx{#1}{}\bi{#1}}
\def\cind#1{\cindx{#1}{}\ci{#1}}
\def\sind#1{\index{#1@\sinlinetwo{#1}}\sinline{#1}}
\def\sqlind#1{\index{#1@\sinlinetwo{#1}}\sinline{#1}}
\def\ttindex#1{\index{#1@\cinlinetwo{#1}}}
%\def\cindex#1{\index{#1@\cinlinetwo{#1}}}
\def\sindex#1{\index{#1@\sinlinetwo{#1}}}
%\def\ttind#1{\index{#1@{\tt #1}}{\tt #1}}
%\def\ttindex#1{\index{#1@{\tt #1}}}
\def\ff#1{#1 {\it ff}} %e.g. \index{pointers|ff}
\def\vocab#1{{\sl #1}\index{#1}}
\def\gind#1{\gindx{#1}{}\ginline{#1}}


\def\skeyind#1{\index{#1@\sinlinetwo{#1} (SQL keyword)}\index{SQL keywords!\sinlinetwo{#1}}}
\def\gkeyind#1{\index{#1@\ginlinetwo{#1} (Gnuplot keyword)}\index{Gnuplot keywords!\ginlinetwo{#1}}}
\def\gsetind#1{\index{#1@\ginlinetwo{#1} (Gnuplot setting)}\index{Gnuplot settings!\ginlinetwo{#1}}}
\def\ckeyind#1{\index{#1@\cinlinetwo{#1} (C keyword)}\index{C keywords!\cinlinetwo{#1}}}

%fold bib citations into the index
\citeindextrue
\makeatletter
\renewcommand\NAT@idxtxt{\NAT@name}
\makeatother


%code listing:
\lstset{columns=fullflexible, basicstyle=\small, emph={apop_data,apop_model,apop_inventory,apop_estimate,apop_estimation_params,gsl_vector,gsl_matrix},emphstyle=\bf\small}
%\def\setlistdefaults{\lstset{frame=single, showstringspaces=false, basicstyle=\small, language=C, breaklines=true}}
\def\setlistdefaults{\lstset{frame=single, frameround=tttt, showstringspaces=false, basicstyle=\small, language=C, breaklines=true}}
\setlistdefaults
%C inline just uses \tt, rather than any fancy encoding.
%\def\cinline#1{\lstinline[language=C, showstringspaces=false, basicstyle=\small\bf,breaklines=true,breakatwhitespace=false,escapechar=\%]{#1}\setlistdefaults}
%\def\cinlinetwo#1{\lstinline[language=C, showstringspaces=false, basicstyle=\small\bf,breaklines=true,breakatwhitespace=false, escapechar=\%]{#1}}

\def\setc{\lstset{language=C}}
\def\setsql{\lstset{language=sql}}

%\def\cinline#1{{\tiny${}_\lfloor$}{#1}\nobreak\hskip 1pt\nobreak\raisebox{4pt}[0pt][0pt]{\tiny${}^\rceil$}}
\def\cinline#1{{\bf\tt #1}}
\def\ci#1{\cinline{#1}}
\def\binline#1{{\bf\tt #1}}
\def\bi#1{\binline{#1}}
\def\sinline#1{{\bf\tt #1}}
\def\si#1{{\bf\tt #1}}
\def\cinlinetwo#1{{\tt #1}}
\def\sinlinetwo#1{{\tt #1}}
\def\binlinetwo#1{{\tt #1}}
\def\ginlinetwo#1{{\tt #1}}
\def\airq#1{{\sl #1}}
\def\gi#1{{\bf\tt #1}}
\def\gitwo#1{{\tt #1}}

\long\def\codefig#1#2{
	\begin{figure}[tb]
    \indwcsub{sample code}{#1.c}
	\hrule\vskip4pt
\lstset{frame=,showstringspaces=false, basicstyle=\small, emphstyle=\bf\small, language=C, breaklines=true}
\lstinputlisting{sources/#1.c}
	\hrule

	\caption{#2 [Online source: \bi{#1.c}]}\label{#1}
	\end{figure}
}


\long\def\codefigbyinclusion#1#2#3{
	\begin{figure*}
	\hrule\vskip4pt
	#1
	\hrule

	\caption{#3}\label{#2}
	\end{figure*}
}

\def\samplecodelocation{\url{http://apophenia.info/msc_book_samples.zip}\xspace}
\def\onlinereflocation{\url{http://apophenia.info/doc}\xspace}


\def\ns#1{\Needspace{#1\baselineskip}}

%margin boxes:
\newlength\mwidth
\setlength\mwidth{1.3cm}
\setlength\fboxsep{5pt} %margin size in margin boxes
\long\def\marginalia#1#2#3{
\Needspace{#1\baselineskip}
\begin{wrapfigure}{l}[\mwidth]{3in}
\fbox{\begin{minipage}{2.8in}
{\bf #2}\vskip .5cm \parindent 5pt \par
\small #3
\end{minipage}
}
\end{wrapfigure}
}

\long\def\marginaliafixed#1#2#3{
\Needspace{#1\baselineskip}
\begin{wrapfigure}[#1]{l}[\mwidth]{3in}
\fbox{\begin{minipage}{2.8in}
{\bf #2}\vskip .5cm\par
\small #3
\end{minipage}
}
\end{wrapfigure}
}

    \comment{
%A simpler, inline version:
\long\def\marginalia#1#2{
\vskip 0.3cm
\hrule
\vskip 0.3cm
{\bf #1}\vskip .5cm\par
\small #2
\vskip 0.3cm
\hrule
\vskip 0.3cm
}

\long\def\marginaliafixed#1#2#3{\marginalia{#2}{#3}}
        }




%Exercises and summaries
\long\def\textblock#1#2{\vspace \baselineskip
%\begin{tabular}{>{\huge}m{1 cm}|m{(\textwidth - 3cm)}}
\begin{tabular}{m{1 cm}|m{(\textwidth - 3cm)}}
%\begin{tabular}{m{1 cm}|p{10cm}}
{#1}&{#2}\\
\end{tabular}\vskip \baselineskip}

%Yes, I agree: this is a terrible, terrible kludge.
\def\sigmaoutline{\scalebox{0.1}{\includegraphics{sigma}}}

\newcounter{ex}[chapter]
%\renewcommand\labelitemi{$\blacktriangleright$}
\long\def\exercise#1{\stepcounter{ex}
\textblock{{\huge ${\mathbb Q}$}$_{\thechapter.\theex}$}{#1}}

\long\def\summarynoitems#1{
\renewcommand\labelitemi{\ding{"E4}}
\textblock{\sigmaoutline}{#1}
\renewcommand\labelitemi{$\bullet$}
}

\long\def\summary#1{\textblock{\sigmaoutline}{
\renewcommand\labelitemi{\ding{"E4}}
\begin{itemize}#1\end{itemize}
\renewcommand\labelitemi{$\bullet$}
}}




%The actual book:
\begin{document}


\setlength{\columnsep}{1.2cm}
\frontmatter
\title{Modeling with Data:\\Modern Statistical Computing with C}
\author{Ben Klemens\\klemens@hss.caltech.edu}
%\date{May 2005}
\begin{center}
\fbox{\begin{minipage}{4in}
\maketitle
\end{minipage}}
\end{center}
\thispagestyle{empty}
\vfill



[A caveat: This book is incomplete. The
first three chapters are finished, but it tapers off from there. It should
already have utility to many people, so it is here for your perusal.
Plain old \copyright 2006, Ben Klemens.]


\setcounter{tocdepth}{1}
%\input apreface
\tableofcontents
\mainmatter
\input intro.tex
\part{Computing}
\input c_crash.tex
\input ctwo.tex
\input sql.tex
\input linear_algebra.tex
\input apop.tex
\input gnuplot.tex
\part{Statistics}
\input projection.tex
\input categories.tex
\input testing.tex
\input mle.tex
\input boot.tex
\backmatter
\input text.tex
\citeindexfalse
\nocite{*}
\bibliographystyle{plainnat}
\iftwocol \end{multicols} \fi
\bibliography{guide} 
\printindex
\end{document}
