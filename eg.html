<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html> <head>
     <title>Apophenia: a library for scientific computing</title>

<!-- Google is watching. -->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-134313-2";
urchinTracker();
</script>


     <link rel="stylesheet" href="typical.css" type="text/css" >
     <script  type="text/javascript" language="JavaScript" src="tree.js"></script>
</head><body>
     <center><table cellpadding=10pt>
     <tr> <td><img width=140px src=flake.gif alt="Patterns in static"></td> 
    <td><table>
     	<tr> <td><center><h2><a href="http://apophenia.info">Apophenia</a></h2></center></td></tr>
<tr><td><div class="qindex"><a class="qindex" href="index.html">&nbsp;Intro</a> | <a class="qindex" href="outline.html">Outline</a> | <a class="qindex" href="globals.html">Index</a> <!--| <a class="qindex" href="files.html">File&nbsp;List&nbsp;</a> -->  </div></td></tr></table>
	</td></tr></table></center>

<!-- Generated by Doxygen 1.7.4 -->
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Some examples </div>  </div>
</div>
<div class="contents">
<div class="textblock"><p>Here are a few pieces of sample code, gathered from elsewhere in the documentation, for testing your installation or to give you a sense of what code with Apophenia's tools looks like. If you'd like more context or explanation, please click through to the page from which the example was taken.</p>
<p>In the documentation for the <a class="el" href="group__models.html#ga85524b1deabd5829227888fd91740cc3">apop_ols</a> model, a program to read in data and run a regression. You'll need to go to that page for the sample data and further discussion.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;apop.h&gt;</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>){
    <a class="code" href="group__conversions.html#gaa57d56a9a364a4f2955d27741bbbf137">apop_text_to_db</a>(.text_file=<span class="stringliteral">&quot;data&quot;</span>, .tabname=<span class="stringliteral">&quot;d&quot;</span>);
    <a class="code" href="struct__apop__data.html">apop_data</a> *data = <a class="code" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a>(<span class="stringliteral">&quot;select * from d&quot;</span>);
    <a class="code" href="struct__apop__model.html">apop_model</a> *est = <a class="code" href="group__models.html#ga0a3be4075a89f7119be95a4718e01ade">apop_estimate</a>(data, <a class="code" href="group__models.html#ga85524b1deabd5829227888fd91740cc3">apop_ols</a>);
    <a class="code" href="apop__model_8c.html#a4fa08e29db38e8dcc111899c942022d9">apop_model_show</a>(est);
}
</pre></div><p>In the <a class="el" href="group__conversions.html#gaa57d56a9a364a4f2955d27741bbbf137">apop_text_to_db</a> page, a variant, demonstrating the use of optional, named arguments:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;apop.h&gt;</span>

<span class="keywordtype">int</span> main(<span class="keywordtype">void</span>){ 
  <a class="code" href="struct__apop__data.html">apop_data</a> *data; 
  <a class="code" href="struct__apop__model.html">apop_model</a> *est;
    <a class="code" href="apop__db_8c.html#a4d81aff912df2982697038c51795e358">apop_db_open</a>(NULL);
    <a class="code" href="group__conversions.html#gaa57d56a9a364a4f2955d27741bbbf137">apop_text_to_db</a>(<span class="stringliteral">&quot;data&quot;</span>, <span class="stringliteral">&quot;d&quot;</span>,.has_row_names= 0,.has_col_names=1);
    data = <a class="code" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a>(<span class="stringliteral">&quot;select * from d&quot;</span>);
    est  = <a class="code" href="group__models.html#ga0a3be4075a89f7119be95a4718e01ade">apop_estimate</a>(data, <a class="code" href="group__models.html#ga85524b1deabd5829227888fd91740cc3">apop_ols</a>);
    printf(<span class="stringliteral">&quot;The OLS coefficients:\n&quot;</span>);
    <a class="code" href="group__output.html#ga3af0274133637ffd31e9708b87783b53">apop_model_print</a>(est);
} 
</pre></div><p>Now, from the Python section of the outline page, the same thing via Python:</p>
<div class="fragment"><pre class="fragment">from apop <span class="keyword">import</span> *
apop_text_to_db(<span class="stringliteral">&quot;data&quot;</span>, <span class="stringliteral">&quot;d&quot;</span>, 0, 1, <span class="keywordtype">None</span>)
data = apop_query_to_data(<span class="stringliteral">&quot;select * from d&quot;</span>)
est  = apop_estimate(data, avar.apop_ols)
<span class="keywordflow">print</span> est

<span class="comment">#And one last example of using a method of the apop_data object:</span>

<span class="keywordflow">print</span> est.parameters.transpose()
</pre></div><p>The same page illustrates some other calls of Apophenia functions via Python, such as the <a class="el" href="stats_8h.html#a8627a1eebf904699e90e66adc8b4b021">apop_test_fisher_exact</a> function.</p>
<div class="fragment"><pre class="fragment"><span class="keyword">from</span> apop <span class="keyword">import</span> *
data = [[15, 13], [18, 19]]
adata = apop_pylist_to_data(data) 

<span class="keywordflow">print</span> <span class="stringliteral">&quot;display the data&quot;</span>
<span class="keywordflow">print</span> adata.matrix

result = apop_test_fisher_exact(adata)
<span class="keywordflow">print</span> result

<span class="keywordflow">print</span> <span class="stringliteral">&quot;Or, just one value:&quot;</span>
<span class="keywordflow">print</span> result.get(<span class="stringliteral">&quot;p value&quot;</span>, -1)
</pre></div><p>From the <a class="el" href="setup.html">Setting up</a> page, an example of gathering data from two processes, saving the input to a database, then doing a later analysis:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;apop.h&gt;</span>

<span class="comment">//Your processes are probably a bit more complex.</span>
<span class="keywordtype">double</span> process_one(gsl_rng *r){
    <span class="keywordflow">return</span> gsl_rng_uniform(r) * gsl_rng_uniform(r) ;
}

<span class="keywordtype">double</span> process_two(gsl_rng *r){
    <span class="keywordflow">return</span> gsl_rng_uniform(r);
}

<span class="keywordtype">int</span> main(){
<a class="code" href="struct__apop__data.html">apop_data</a> *m;
<span class="keywordtype">double</span>    p1, p2;
<span class="keywordtype">int</span>       i;
gsl_rng   *r = <a class="code" href="group__convenience__fns.html#gada044cf02135422a9f9292b6054c86dd">apop_rng_alloc</a>(123);

    <span class="comment">//create the database and the data table.</span>
    <a class="code" href="apop__db_8c.html#a4d81aff912df2982697038c51795e358">apop_db_open</a>(<span class="stringliteral">&quot;runs.db&quot;</span>);
    <a class="code" href="apop__db_8c.html#a01d501ca84ade92bc72fd4f67a617f64">apop_table_exists</a>(<span class="stringliteral">&quot;samples&quot;</span>,1); <span class="comment">//If the table already exists, delete it.</span>
    <a class="code" href="group__queries.html#ga236452b3305ea7b791c781d91a819e3b">apop_query</a>(<span class="stringliteral">&quot;create table samples(iteration, process, value); begin;&quot;</span>);

    <span class="comment">//populate the data table with runs.</span>
    <span class="keywordflow">for</span> (i=0; i&lt;1000; i++){
        p1      = process_one(r);
        p2      = process_two(r);
        <a class="code" href="group__queries.html#ga236452b3305ea7b791c781d91a819e3b">apop_query</a>(<span class="stringliteral">&quot;insert into samples values(%i, %i, %g);&quot;</span>, i, 1, p1);
        <a class="code" href="group__queries.html#ga236452b3305ea7b791c781d91a819e3b">apop_query</a>(<span class="stringliteral">&quot;insert into samples values(%i, %i, %g);&quot;</span>, i, 2, p2);
    }
    <a class="code" href="group__queries.html#ga236452b3305ea7b791c781d91a819e3b">apop_query</a>(<span class="stringliteral">&quot;commit;&quot;</span>); <span class="comment">//the begin-commit wrapper saves writes to the drive.</span>

    <span class="comment">//pull the data from the database, converting it into a table along the way. </span>
    m  = <a class="code" href="apop__conversions_8c.html#aebe17fe6f2b0c49c0c90824b7a68ff90">apop_db_to_crosstab</a>(<span class="stringliteral">&quot;samples&quot;</span>, <span class="stringliteral">&quot;iteration&quot;</span>,<span class="stringliteral">&quot;process&quot;</span>, <span class="stringliteral">&quot;value&quot;</span>);

    <a class="code" href="stats_8h.html#a79fc915cc70adb705029a8b9322abd7d">Apop_col</a>(m, 0, v1); <span class="comment">//get vector views of the two table columns.</span>
    <a class="code" href="stats_8h.html#a79fc915cc70adb705029a8b9322abd7d">Apop_col</a>(m, 1, v2);

    <span class="comment">//Output a table of means/variances, and t-test results.</span>
    printf(<span class="stringliteral">&quot;\t   mean\t\t   var\n&quot;</span>);
    printf(<span class="stringliteral">&quot;process 1: %f\t%f\n&quot;</span>, <a class="code" href="group__vector__moments.html#ga0f69c8414f1d93fa15f3a631710dcd7a">apop_mean</a>(v1), <a class="code" href="group__vector__moments.html#gacc311abe133963c7959162a7d3d83fb8">apop_var</a>(v1));
    printf(<span class="stringliteral">&quot;process 2: %f\t%f\n\n&quot;</span>, <a class="code" href="group__vector__moments.html#ga0f69c8414f1d93fa15f3a631710dcd7a">apop_mean</a>(v2), <a class="code" href="group__vector__moments.html#gacc311abe133963c7959162a7d3d83fb8">apop_var</a>(v2));
    printf(<span class="stringliteral">&quot;t test\n&quot;</span>);
    <a class="code" href="group__output.html#ga9a30c437ec11a11e37e0db7f82386275">apop_data_show</a>(<a class="code" href="group__ttest.html#ga65c94b79fe91308dc97829741acc9322">apop_t_test</a>(v1, v2));
    <a class="code" href="group__apop__print.html#gab45a848e5dbcaf82b5b95cd03f7b396a">apop_data_print</a>(m, <span class="stringliteral">&quot;the_data.txt&quot;</span>); <span class="comment">//does not overwrite; appends.</span>
    <span class="keywordflow">return</span> 0;
}
</pre></div><p>A demonstration of <a class="el" href="group__output.html#ga0db4cee7586798d4fcdff8ebf67dd0b3">apop_plot_line_and_scatter</a> . You'll need a database from the {<em>Modeling</em> with Data} sample code, at <a href="http://modelingwithdata.org/appendices.html.">http://modelingwithdata.org/appendices.html.</a></p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;apop.h&gt;</span>

<span class="keywordtype">int</span> main(){
<a class="code" href="struct__apop__data.html">apop_data</a>   *data, *data_copy;
<a class="code" href="struct__apop__model.html">apop_model</a>  *est;
FILE        *f;
<span class="keywordtype">char</span>        outfile[]   = <span class="stringliteral">&quot;scatter.gplot&quot;</span>;

    <a class="code" href="apop__db_8c.html#a4d81aff912df2982697038c51795e358">apop_db_open</a>(<span class="stringliteral">&quot;data-metro.db&quot;</span>);
    data = <a class="code" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a>(<span class="stringliteral">&quot;select riders, year from riders where station like &#39;Silver%%&#39;&quot;</span>);
    <a class="code" href="apop__db_8c.html#acf205f62e9432fe293b05c077d1b61d4">apop_db_close</a>();

    <span class="comment">//The regression destroys your data, so copy it first.</span>
    data_copy   = <a class="code" href="apop__data_8c.html#add67e6838ce2521a1d756894dc9b5ccf">apop_data_copy</a>(data);

    <span class="comment">//Run OLS, display results on terminal</span>
    est  = <a class="code" href="group__models.html#ga0a3be4075a89f7119be95a4718e01ade">apop_estimate</a>(data, apop_OLS);
    <a class="code" href="apop__model_8c.html#a4fa08e29db38e8dcc111899c942022d9">apop_model_show</a>(est);

    <span class="comment">//Prep the file with a header, then call the function.</span>
    f    = fopen(outfile, <span class="stringliteral">&quot;w&quot;</span>);
    fprintf(f,<span class="stringliteral">&quot;set term postscript;\n set output \&quot;scatter.eps\&quot;\n set yrange [0:*]\n&quot;</span>);
    <a class="code" href="group__output.html#ga0db4cee7586798d4fcdff8ebf67dd0b3">apop_plot_line_and_scatter</a>(data_copy, est, .output_pipe=f);
    fclose(f);

    <span class="keywordflow">return</span> 0;
}
</pre></div><p>In the <a class="el" href="outline.html">An outline of the library</a> section on map/apply, a new <img class="formulaInl" alt="$t$" src="form_9.png"/>-test on every row, with all operations acting on entire rows rather than individual data points:</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;apop.h&gt;</span>

<span class="keywordtype">double</span> row_offset;
gsl_rng *r;

<span class="keywordtype">void</span> offset_rng(<span class="keywordtype">double</span> *v){*v = gsl_rng_uniform(r) + row_offset;}
<span class="keywordtype">double</span> find_tstat(gsl_vector *in){ <span class="keywordflow">return</span> <a class="code" href="group__vector__moments.html#ga0f69c8414f1d93fa15f3a631710dcd7a">apop_mean</a>(in)/sqrt(<a class="code" href="group__vector__moments.html#gacc311abe133963c7959162a7d3d83fb8">apop_var</a>(in));}
<span class="keywordtype">double</span> conf(<span class="keywordtype">double</span> in, <span class="keywordtype">void</span> *df){ <span class="keywordflow">return</span> gsl_cdf_tdist_P(in, *(<span class="keywordtype">int</span> *)df);}

<span class="keywordtype">int</span> main(){
    <a class="code" href="struct__apop__data.html">apop_data</a> *d = <a class="code" href="apop__data_8c.html#ac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a>(0, 10, 100);
    r = <a class="code" href="group__convenience__fns.html#gada044cf02135422a9f9292b6054c86dd">apop_rng_alloc</a>(3242);
    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt; 10; i++){
        row_offset = gsl_rng_uniform(r)*2 -1;
        <a class="code" href="stats_8h.html#a74dd4339556eb22240d21d19f1ad6dc8">Apop_row</a>(d, i, onerow);
        <a class="code" href="group__mapply.html#ga51964750c64d327e52e2230019e44f66">apop_vector_apply</a>(onerow, offset_rng);
    }

    <span class="keywordtype">size_t</span> df = d-&gt;matrix-&gt;size2-1;
    <a class="code" href="struct__apop__data.html">apop_data</a> *means = <a class="code" href="group__mapply.html#gaacff3707e418a067104c77c410b43f69">apop_map</a>(d, .fn_v = <a class="code" href="group__vector__moments.html#ga92c6abe8ada7ed8121c6881bcc6daf93">apop_vector_mean</a>, .part =<span class="charliteral">&#39;r&#39;</span>);
    <a class="code" href="struct__apop__data.html">apop_data</a> *tstats = <a class="code" href="group__mapply.html#gaacff3707e418a067104c77c410b43f69">apop_map</a>(d, .fn_v = find_tstat, .part =<span class="charliteral">&#39;r&#39;</span>);
    <a class="code" href="struct__apop__data.html">apop_data</a> *confidences = <a class="code" href="group__mapply.html#gaacff3707e418a067104c77c410b43f69">apop_map</a>(tstats, .fn_dp = conf, .param = &amp;df);

    printf(<span class="stringliteral">&quot;means:\t\t&quot;</span>); <a class="code" href="group__output.html#ga9a30c437ec11a11e37e0db7f82386275">apop_data_show</a>(means);
    printf(<span class="stringliteral">&quot;t stats:\t&quot;</span>); <a class="code" href="group__output.html#ga9a30c437ec11a11e37e0db7f82386275">apop_data_show</a>(tstats);
    printf(<span class="stringliteral">&quot;confidences:\t&quot;</span>); <a class="code" href="group__output.html#ga9a30c437ec11a11e37e0db7f82386275">apop_data_show</a>(confidences);
}
</pre></div><p>In the documentation for <a class="el" href="group__queries.html#ga2fbd580cd71f481ae04ee03b5cf64ff5">apop_query_to_text</a>, a program to list all the tables in an SQLite database. </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;apop.h&gt;</span>

<span class="keywordtype">void</span> print_table_list(<span class="keywordtype">char</span> *db_file){
    <a class="code" href="apop__db_8c.html#a4d81aff912df2982697038c51795e358">apop_db_open</a>(db_file);
    <a class="code" href="struct__apop__data.html">apop_data</a> *tab_list= <a class="code" href="group__queries.html#ga2fbd580cd71f481ae04ee03b5cf64ff5">apop_query_to_text</a>(<span class="stringliteral">&quot;select name from sqlite_master where type==\&quot;table\&quot;;&quot;</span>);
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; tab_list-&gt;textsize[0]; i++)
        printf(<span class="stringliteral">&quot;%s\n&quot;</span>, tab_list-&gt;text[i][0]);
}

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv){
    <span class="keywordflow">if</span> (argc == 1){
        printf(<span class="stringliteral">&quot;Give me a database name, and I will print out the list of tables contained therein.\n&quot;</span>);
        <span class="keywordflow">return</span> 0; 
    }
    print_table_list(argv[1]);
}
</pre></div><p>Finally, a demonstration of fixing parameters to create a marginal distribution, via <a class="el" href="stats_8h.html#ab4f6ca7e042ac7c09c3c01d29702a739">apop_model_fix_params</a> </p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;apop.h&gt;</span>

<span class="keywordtype">int</span> main(){
    gsl_rng *r    = <a class="code" href="group__convenience__fns.html#gada044cf02135422a9f9292b6054c86dd">apop_rng_alloc</a>(10);
    <span class="keywordtype">size_t</span> i, ct = 5e4;

    <span class="comment">//set up the model &amp; params</span>
    <a class="code" href="struct__apop__data.html">apop_data</a> *d  = <a class="code" href="apop__data_8c.html#ac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a>(ct,2);
    <a class="code" href="struct__apop__data.html">apop_data</a> *params = <a class="code" href="apop__data_8c.html#ac39d6a56933b6f084328ec5ecd5090d8">apop_data_alloc</a>(2,2,2);
    <a class="code" href="types_8h.html#a4ed914f400ade913970ebbe698176218">apop_data_fill</a>(params, 8,  1, 0.5,
                           2,  0.5, 1);
    <a class="code" href="struct__apop__model.html">apop_model</a> *pvm = <a class="code" href="group__models.html#ga14f2bd54421fd6629baccb8a41ecd304">apop_model_copy</a>(<a class="code" href="group__models.html#ga3a4389e6e2a1a2ea606f89d55ec558d3">apop_multivariate_normal</a>);
    pvm-&gt;<a class="code" href="struct__apop__model.html#a211b10fea629f6fa5c9e76bf5ed3b5f4">parameters</a> = <a class="code" href="apop__data_8c.html#add67e6838ce2521a1d756894dc9b5ccf">apop_data_copy</a>(params);

    <span class="comment">//make random draws from the multivar. normal</span>
    <span class="comment">//this `pull a row view, fill its data element&#39; form works for rows but not cols.</span>
    <span class="keywordflow">for</span>(i=0; i&lt; ct; i++){
        <a class="code" href="stats_8h.html#a74dd4339556eb22240d21d19f1ad6dc8">Apop_row</a>(d, i, onerow);
        <a class="code" href="group__models.html#gaca737ed521192a76a307bbf825ab4a97">apop_draw</a>(onerow-&gt;data, r, pvm);
    }

    <span class="comment">//set up and estimate a model with fixed covariance matrix but free means</span>
    gsl_vector_set_all(pvm-&gt;<a class="code" href="struct__apop__model.html#a211b10fea629f6fa5c9e76bf5ed3b5f4">parameters</a>-&gt;vector, GSL_NAN);
    <a class="code" href="struct__apop__model.html">apop_model</a> *mep1   = <a class="code" href="apop__fix__params_8c.html#ab4f6ca7e042ac7c09c3c01d29702a739">apop_model_fix_params</a>(pvm);
    <a class="code" href="struct__apop__model.html">apop_model</a> *e1  = <a class="code" href="group__models.html#ga0a3be4075a89f7119be95a4718e01ade">apop_estimate</a>(d, *mep1);
    
    <span class="comment">//compare results</span>
    printf(<span class="stringliteral">&quot;original params: &quot;</span>);
    <a class="code" href="group__apop__print.html#ga8eafc3727869f5ec195809ad6686ba7b">apop_vector_show</a>(params-&gt;vector);
    printf(<span class="stringliteral">&quot;estimated params: &quot;</span>);
    <a class="code" href="group__apop__print.html#ga8eafc3727869f5ec195809ad6686ba7b">apop_vector_show</a>(e1-&gt;<a class="code" href="struct__apop__model.html#a211b10fea629f6fa5c9e76bf5ed3b5f4">parameters</a>-&gt;vector);
    <span class="keywordflow">return</span> 0;
}
</pre></div> </div></div>
<p><p>
<div class="tiny">Autogenerated by doxygen on Fri Mar 2 2012.</div></body></html>
