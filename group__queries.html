<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html> <head>
     <title>Apophenia: a library for scientific computing</title>
<!-- Google is watching. -->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-134313-2";
urchinTracker();
</script>
     <link rel="stylesheet" href="typical.css" type="text/css" >
     <script  type="text/javascript" language="JavaScript" src="tree.js"></script>
</head><body>
     <center><table cellpadding=10pt>
     <tr> <td><img width=140px src=flake.gif alt="Patterns in static"></td> 
    <td><table>
     	<tr> <td><center><h2><a href="http://apophenia.info">Apophenia</a></h2></center></td></tr>
<tr><td><div class="qindex"><a class="qindex" href="index.html">&nbsp;Intro</a> | <a class="qindex" href="outline.html">Outline</a> | <a class="qindex" href="globals.html">Index</a> <!--| <a class="qindex" href="files.html">File&nbsp;List&nbsp;</a> -->  </div></td></tr></table>
	</td></tr></table></center>
<!-- Generated by Doxygen 1.8.1.1 -->
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Queries</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gaf28e7d098a9bae73f246186632a82faf"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaf28e7d098a9bae73f246186632a82faf"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>Store_settings</b>&#160;&#160;&#160;int v = apop_opts.verbose; apop_opts.verbose=0;/*hack to prevent double-printing.*/ \</td></tr>
<tr class="memitem:ga2e2152950499d383546b6adfd753431f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga2e2152950499d383546b6adfd753431f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>Restore_settings</b>&#160;&#160;&#160;apop_opts.verbose=v;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga236452b3305ea7b791c781d91a819e3b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__queries.html#ga236452b3305ea7b791c781d91a819e3b">apop_query</a> (const char *fmt,...)</td></tr>
<tr class="memitem:ga2fbd580cd71f481ae04ee03b5cf64ff5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__queries.html#ga2fbd580cd71f481ae04ee03b5cf64ff5">apop_query_to_text</a> (const char *fmt,...)</td></tr>
<tr class="memitem:gade862993166c6482f53562fb77721db9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a> (const char *fmt,...)</td></tr>
<tr class="memitem:ga8a1da4d925dbafdd2b3318672eac751f"><td class="memItemLeft" align="right" valign="top">gsl_matrix *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__queries.html#ga8a1da4d925dbafdd2b3318672eac751f">apop_query_to_matrix</a> (const char *fmt,...)</td></tr>
<tr class="memitem:ga830703db838855b8abd636069c7145de"><td class="memItemLeft" align="right" valign="top">gsl_vector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__queries.html#ga830703db838855b8abd636069c7145de">apop_query_to_vector</a> (const char *fmt,...)</td></tr>
<tr class="memitem:ga1ad75f9dfba696a3741e28896ed5b75d"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__queries.html#ga1ad75f9dfba696a3741e28896ed5b75d">apop_query_to_float</a> (const char *fmt,...)</td></tr>
<tr class="memitem:ga1f06db34e05b5afb63112f83ad2317b8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__queries.html#ga1f06db34e05b5afb63112f83ad2317b8">apop_query_to_mixed_data</a> (const char *typelist, const char *fmt,...)</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>These functions query the database, and most return a value for use on the C-side.</p>
<p>In all cases, your query may be in <code>printf</code> form. For example: </p>
<div class="fragment"><div class="line"><span class="keywordtype">char</span> tabname[] = <span class="stringliteral">&quot;demographics&quot;</span>;</div>
<div class="line"><span class="keywordtype">char</span> colname[] = <span class="stringliteral">&quot;heights&quot;</span>;</div>
<div class="line"><span class="keywordtype">int</span> min_height = 175;</div>
<div class="line"><a class="code" href="group__queries.html#ga236452b3305ea7b791c781d91a819e3b">apop_query</a>(<span class="stringliteral">&quot;select %s from %s where %s &gt; %i&quot;</span>, colname, tabname, colname, min_height);</div>
</div><!-- fragment --><ul>
<li>Blanks in the database (i.e., <code> NULL</code>s) and elements that match <a class="el" href="structapop__opts__type.html">apop_opts.db_nan</a> are filled with <code>NAN</code>s in the matrix. </li>
</ul>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga236452b3305ea7b791c781d91a819e3b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int apop_query </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Send a query to the database that returns no data.
</pre> <dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">fmt</td><td>A <code>printf</code>-style SQL query. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>0 on success, 1 on failure. </dd></dl>

</div>
</div>
<a class="anchor" id="gade862993166c6482f53562fb77721db9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structapop__data.html">apop_data</a>* apop_query_to_data </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Queries the database, and dumps the result into an \ref apop_data set.
</pre><p>If <a class="el" href="structapop__opts__type.html">apop_opts.db_name_column</a> is set (it defaults to being "row_names"), and the name of a column matches the name, then the row names are read from that column. </p>

</div>
</div>
<a class="anchor" id="ga1ad75f9dfba696a3741e28896ed5b75d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">double apop_query_to_float </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Queries the database, and dumps the result into a single double-precision floating point number.
</pre> <dl class="section return"><dt>Returns:</dt><dd>A double, actually.</dd></dl>
<ul>
<li>This calls <a class="el" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a> and returns the (0,0)th element of the returned matrix. Thus, if your query returns multiple lines, you will get no warning, and the function will return the first in the list (which is not always well-defined; maybe use an {<em>order</em> by} clause in your query if you expect multiple lines).</li>
</ul>
<ul>
<li>If <code>apop_opts.db_name_column</code> is set, then I'll ignore that column. It gets put into the names of the <a class="el" href="gentle.html#apop_data">apop_data</a> set, and then thrown away when I look at only the <code>gsl_matrix</code> element of that set.</li>
</ul>
<p>If the query returns no rows at all, the function returns <code>NAN</code>. </p>

</div>
</div>
<a class="anchor" id="ga8a1da4d925dbafdd2b3318672eac751f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_matrix* apop_query_to_matrix </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Queries the database, and dumps the result into a matrix.</p>
<p>Uses <a class="el" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a> and returns just the matrix part; see that function for notes.</p>
<ul>
<li>If <code>apop_opts.db_name_column</code> is set, then I'll ignore that column. It gets put into the names of the <a class="el" href="gentle.html#apop_data">apop_data</a> set, and then thrown away when I return only the <code>gsl_matrix</code> part of that set.</li>
</ul>
<dl class="section return"><dt>Returns:</dt><dd>A <code>gsl_matrix</code>. </dd></dl>

</div>
</div>
<a class="anchor" id="ga1f06db34e05b5afb63112f83ad2317b8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structapop__data.html">apop_data</a>* apop_query_to_mixed_data </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>typelist</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Query data to an \c apop_data set, but a mix of names, vectors, matrix elements, and text.
</pre><p>If you are querying to a matrix and maybe a name, use <code>apop_query_to_data</code> (and set <a class="el" href="structapop__opts__type.html">apop_opts.db_name_column</a> if desired). But if your data is a mix of text and numbers, use this.</p>
<p>The first argument is a character string consisting of the letters <code>nvmtw</code>, one for each column of the SQL output, indicating whether the column is a name, vector, matrix column, text column, or weight vector. You can have only one n, v, and w.</p>
<p>If the query produces more columns than there are elements in the column specification, then the remainder are dumped into the text section. If there are fewer columns produced than given in the spec, the additional elements will be allocated but not filled (i.e., they are uninitialized and will have garbage).</p>
<p>The 'n' character indicates row, meaning that <a class="el" href="structapop__opts__type.html">apop_opts.db_name_column</a> is ignored).</p>
<p>As with the other <code>apop_query_to_</code>... functions, the query can include printf-style format specifiers. </p>

</div>
</div>
<a class="anchor" id="ga2fbd580cd71f481ae04ee03b5cf64ff5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structapop__data.html">apop_data</a>* apop_query_to_text </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Dump the results of a query into an array of strings.
</pre><dl class="section return"><dt>Returns:</dt><dd>An <a class="el" href="gentle.html#apop_data">apop_data</a> structure with the <code>text</code> element filled. Notice that this is always a 2-D array, even if the query returns a single column. In that case, use <code>returned_tab-&gt;text[i][0]</code> to refer to row <code>i</code>.</dd></dl>
<p>For example, the following function will list the tables in a database (much like you could do from the command line using <code>sqlite3 dbname.db ".table"</code>).</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;apop.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> print_table_list(<span class="keywordtype">char</span> *db_file){</div>
<div class="line">    <a class="code" href="apop__db_8c.html#a4d81aff912df2982697038c51795e358">apop_db_open</a>(db_file);</div>
<div class="line">    <a class="code" href="structapop__data.html">apop_data</a> *tab_list= <a class="code" href="group__queries.html#ga2fbd580cd71f481ae04ee03b5cf64ff5">apop_query_to_text</a>(<span class="stringliteral">&quot;select name from sqlite_master where type==\&quot;table\&quot;;&quot;</span>);</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt; tab_list-&gt;textsize[0]; i++)</div>
<div class="line">        printf(<span class="stringliteral">&quot;%s\n&quot;</span>, tab_list-&gt;text[i][0]);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv){</div>
<div class="line">    <span class="keywordflow">if</span> (argc == 1){</div>
<div class="line">        printf(<span class="stringliteral">&quot;Give me a database name, and I will print out the list of tables contained therein.\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 0; </div>
<div class="line">    }</div>
<div class="line">    print_table_list(argv[1]);</div>
<div class="line">}</div>
</div><!-- fragment --> 
</div>
</div>
<a class="anchor" id="ga830703db838855b8abd636069c7145de"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">gsl_vector* apop_query_to_vector </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>...</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<pre class="fragment">Queries the database, and dumps the first column of the result into a gsl_vector.
</pre><dl class="section return"><dt>Returns:</dt><dd>A <code>gsl_vector</code> holding the first column of the returned matrix. Thus, if your query returns multiple lines, you will get no warning, and the function will return the first in the list.</dd></dl>
<ul>
<li>Uses <a class="el" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a> internally, then throws away all but the first column of the matrix. </li>
<li>If <code>apop_opts.db_name_column</code> is set, then I'll ignore that column. It gets put into the names of the <a class="el" href="gentle.html#apop_data">apop_data</a> set, and then thrown away when I look at only the <code>gsl_matrix</code> part of that set.</li>
</ul>
<p>If the query returns no columns at all, the function returns <code>NULL</code>. </p>

</div>
</div>
</div><!-- contents -->
<p><p>
<div class="tiny">Autogenerated by doxygen on Sun Oct 7 2012.</div></body></html>
