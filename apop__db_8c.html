<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html> <head>
     <title>Apophenia: a library for scientific computing</title>
<!-- Google is watching. -->
<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-134313-2";
urchinTracker();
</script>
     <link rel="stylesheet" href="typical.css" type="text/css" >
     <script  type="text/javascript" language="JavaScript" src="tree.js"></script>
</head><body>
     <center><table cellpadding=10pt>
     <tr> <td><img width=140px src=flake.gif alt="Patterns in static"></td> 
    <td><table>
     	<tr> <td><center><h2><a href="http://apophenia.info">Apophenia</a></h2></center></td></tr>
<tr><td><div class="qindex"><a class="qindex" href="index.html">&nbsp;Intro</a> | <a class="qindex" href="outline.html">Outline</a> | <a class="qindex" href="globals.html">Index</a> <!--| <a class="qindex" href="files.html">File&nbsp;List&nbsp;</a> -->  </div></td></tr></table>
	</td></tr></table></center>
<!-- Generated by Doxygen 1.8.1.1 -->
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">apop_db.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcallback__t.html">callback_t</a></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtab__exists__t.html">tab_exists_t</a></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a65ecb3cc386e0c837b2a84ca829e8a7e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a65ecb3cc386e0c837b2a84ca829e8a7e"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ERRCHECK</b>&#160;&#160;&#160;{<a class="el" href="asst_8h.html#a482b1a29fd707240d4f99d6da0fa0ddf">Apop_assert_c</a>(err==NULL, 1, 0, &quot;%s: %s&quot;,query, err);}</td></tr>
<tr class="memitem:a7ae9f2adfaf130062621be98ab895fe1"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7ae9f2adfaf130062621be98ab895fe1"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ERRCHECK_NR</b>&#160;&#160;&#160;{<a class="el" href="asst_8h.html#a482b1a29fd707240d4f99d6da0fa0ddf">Apop_assert_c</a>(err==NULL, NULL, 0, &quot;%s: %s&quot;,query, err);}</td></tr>
<tr class="memitem:ad6a9faa1c0cff7284482f44489f03db8"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>Fillin</b>(query, fmt)</td></tr>
<tr class="memitem:gaf28e7d098a9bae73f246186632a82faf"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaf28e7d098a9bae73f246186632a82faf"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>Store_settings</b>&#160;&#160;&#160;int v = apop_opts.verbose; apop_opts.verbose=0;/*hack to prevent double-printing.*/ \</td></tr>
<tr class="memitem:ga2e2152950499d383546b6adfd753431f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga2e2152950499d383546b6adfd753431f"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>Restore_settings</b>&#160;&#160;&#160;apop_opts.verbose=v;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ade5d009b6308c7a4c0b79be05c7f8a07"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__db_8c.html#ade5d009b6308c7a4c0b79be05c7f8a07">apop_db_rng_init</a> (int seed)</td></tr>
<tr class="memitem:a4d81aff912df2982697038c51795e358"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__db_8c.html#a4d81aff912df2982697038c51795e358">apop_db_open</a> (char const *filename)</td></tr>
<tr class="memitem:a01d501ca84ade92bc72fd4f67a617f64"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__db_8c.html#a01d501ca84ade92bc72fd4f67a617f64">apop_table_exists</a> (char const *name, char remove)</td></tr>
<tr class="memitem:acf205f62e9432fe293b05c077d1b61d4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__db_8c.html#acf205f62e9432fe293b05c077d1b61d4">apop_db_close</a> (char vacuum)</td></tr>
<tr class="memitem:ga236452b3305ea7b791c781d91a819e3b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__queries.html#ga236452b3305ea7b791c781d91a819e3b">apop_query</a> (const char *fmt,...)</td></tr>
<tr class="memitem:ga2fbd580cd71f481ae04ee03b5cf64ff5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__queries.html#ga2fbd580cd71f481ae04ee03b5cf64ff5">apop_query_to_text</a> (const char *fmt,...)</td></tr>
<tr class="memitem:gade862993166c6482f53562fb77721db9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__queries.html#gade862993166c6482f53562fb77721db9">apop_query_to_data</a> (const char *fmt,...)</td></tr>
<tr class="memitem:ga8a1da4d925dbafdd2b3318672eac751f"><td class="memItemLeft" align="right" valign="top">gsl_matrix *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__queries.html#ga8a1da4d925dbafdd2b3318672eac751f">apop_query_to_matrix</a> (const char *fmt,...)</td></tr>
<tr class="memitem:ga830703db838855b8abd636069c7145de"><td class="memItemLeft" align="right" valign="top">gsl_vector *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__queries.html#ga830703db838855b8abd636069c7145de">apop_query_to_vector</a> (const char *fmt,...)</td></tr>
<tr class="memitem:ga1ad75f9dfba696a3741e28896ed5b75d"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__queries.html#ga1ad75f9dfba696a3741e28896ed5b75d">apop_query_to_float</a> (const char *fmt,...)</td></tr>
<tr class="memitem:ga1f06db34e05b5afb63112f83ad2317b8"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structapop__data.html">apop_data</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__queries.html#ga1f06db34e05b5afb63112f83ad2317b8">apop_query_to_mixed_data</a> (const char *typelist, const char *fmt,...)</td></tr>
<tr class="memitem:a5b2acb4c4f767a219b4443d63e65e5a8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5b2acb4c4f767a219b4443d63e65e5a8"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>qxprintf</b> (char **q, char *format,...)</td></tr>
<tr class="memitem:ga1207fee6d1e23cea944f7c7effd86851"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__conversions.html#ga1207fee6d1e23cea944f7c7effd86851">apop_data_to_db</a> (const <a class="el" href="structapop__data.html">apop_data</a> *set, const char *tabname, const char output_append)</td></tr>
<tr class="memitem:ae10510ee8eb7a00e5b6734c183b6c777"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__db_8c.html#ae10510ee8eb7a00e5b6734c183b6c777">apop_db_merge_table</a> (char *db_file, char *tabname, char inout)</td></tr>
<tr class="memitem:a5aed91e24f47e18dfe42bd82ceab1286"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__db_8c.html#a5aed91e24f47e18dfe42bd82ceab1286">apop_db_merge</a> (char *db_file, char inout)</td></tr>
<tr class="memitem:gaf6b4c155f970f1a63c9d9cfba6300189"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ttest.html#gaf6b4c155f970f1a63c9d9cfba6300189">apop_db_t_test</a> (char *tab1, char *col1, char *tab2, char *col2)</td></tr>
<tr class="memitem:gaeb5eee3a851024eb4a2835b0d501e15a"><td class="memItemLeft" align="right" valign="top">double&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__ttest.html#gaeb5eee3a851024eb4a2835b0d501e15a">apop_db_paired_t_test</a> (char *tab1, char *col1, char *col2)</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a7975faa07196cf463ec261ff0ddc3ccc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structapop__opts__type.html">apop_opts_type</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="apop__db_8c.html#a7975faa07196cf463ec261ff0ddc3ccc">apop_opts</a></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>An easy front end to SQLite. Includes a few nice features like a variance, skew, and kurtosis aggregator for SQL. </p>
</div><hr/><h2>Macro Definition Documentation</h2>
<a class="anchor" id="ad6a9faa1c0cff7284482f44489f03db8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define Fillin</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">query, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">fmt&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordtype">char</span>        *query;                 \</div>
<div class="line">  va_list   argp;                   \</div>
<div class="line">    va_start(argp, fmt);            \</div>
<div class="line">    vasprintf(&amp;query, fmt, argp);   \</div>
<div class="line">    va_end(argp);                   \</div>
<div class="line">    Apop_notify(2, <span class="stringliteral">&quot;%s&quot;</span>, query);</div>
</div><!-- fragment -->
</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="acf205f62e9432fe293b05c077d1b61d4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int apop_db_close </td>
          <td>(</td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>vacuum</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Closes the database on disk. If you opened the database with <code>apop_db_open(NULL)</code>, then this is basically optional.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">vacuum</td><td>'v': vacuum&mdash;do clean-up to minimize the size of the database on disk.<br/>
 'q': Don't bother; just close the database. (default = 'q')</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>0 on OK, nonzero on error. This function uses the <a class="el" href="designated.html">Designated initializers</a> syntax for inputs. </dd></dl>

</div>
</div>
<a class="anchor" id="a5aed91e24f47e18dfe42bd82ceab1286"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apop_db_merge </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>db_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>inout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Merge a database on the hard drive with the database currently open.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">db_file</td><td>The name of a file on disk. [No default; can't be <code>NULL</code>] </td></tr>
    <tr><td class="paramname">inout</td><td>Do we copy data in to the currently-open main db [<code>'i'</code>] or out to the specified auxiliary db[<code>'o'</code>]? [default = 'i']</td></tr>
  </table>
  </dd>
</dl>
<p>If a table exists in the new database but not in the currently open one, then it is simply copied over. If there are tables with the same name in both databases, then the data from the new table is inserted into the main database's table with the same name. [The function just calls <code>insert into main.tab select * from merge_me.tab</code>.]</p>
<ul>
<li>This is sqlite-only; I'm not sure if it really makes much sense for mySQL.</li>
</ul>
<p>This function uses the <a class="el" href="designated.html">Designated initializers</a> syntax for inputs. </p>

</div>
</div>
<a class="anchor" id="ae10510ee8eb7a00e5b6734c183b6c777"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apop_db_merge_table </td>
          <td>(</td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>db_file</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>tabname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>inout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Merge a single table from a database on the hard drive with the database currently open.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">db_file</td><td>The name of a file on disk. [default = <code>NULL</code>] </td></tr>
    <tr><td class="paramname">tabname</td><td>The name of the table in that database to be merged in. [No default] </td></tr>
    <tr><td class="paramname">inout</td><td>Do we copy data in to the currently-open main db [<code>'i'</code>] or out to the specified auxiliary db[<code>'o'</code>]? [default = 'i']</td></tr>
  </table>
  </dd>
</dl>
<p>If the table exists in the new database but not in the currently open one, then it is simply copied over. If there is a table with the same name in the currently open database, then the data from the new table is inserted into the main database's table with the same name. [The function just calls <code>insert into main.tab select * from merge_me.tab</code>.]</p>
<p>This function uses the <a class="el" href="designated.html">Designated initializers</a> syntax for inputs. </p>

</div>
</div>
<a class="anchor" id="a4d81aff912df2982697038c51795e358"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int apop_db_open </td>
          <td>(</td>
          <td class="paramtype">char const *&#160;</td>
          <td class="paramname"><em>filename</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>If you want to use a database on the hard drive instead of memory, then call this once and only once before using any other database utilities.</p>
<p>If you want a disposable database which you won't use after the program ends, don't bother with this function.</p>
<p>The trade-offs between an on-disk database and an in-memory db are as one would expect: memory is faster, but is destroyed when the program exits. SQLite includes a command line utility (<code>sqlite3</code>) which let you ask queries of a database on disk, which may be useful for debugging. There are also some graphical front-ends; just ask your favorite search engine for <a href="http://www.google.com/search?&amp;q=sqlite+gui">SQLite GUI</a>.</p>
<p>MySQL users: either set the environment variable APOP_DB_ENGINE=mysql or set <code>apop_opts.db_engine</code> = 'm'.</p>
<p>The Apophenia package assumes you are only using a single SQLite database at a time; if not, the <a class="el" href="db_8h.html#a5aed91e24f47e18dfe42bd82ceab1286">apop_db_merge</a> and <a class="el" href="db_8h.html#ae10510ee8eb7a00e5b6734c183b6c777">apop_db_merge_table</a> functions may help.</p>
<p>When you are done doing your database manipulations, be sure to call <a class="el" href="db_8h.html#acf205f62e9432fe293b05c077d1b61d4">apop_db_close</a> if writing to disk.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">filename</td><td>The name of a file on the hard drive on which to store the database. If <code>NULL</code>, then the database will be kept in memory (in which case, the other database functions will call this function for you and you don't need to bother).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>0: everything OK<br/>
 1: database did not open. </dd></dl>

</div>
</div>
<a class="anchor" id="ade5d009b6308c7a4c0b79be05c7f8a07"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void apop_db_rng_init </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>seed</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Random numbers are generated inside the database using a separate RNG. This will initialize it for you, just like <a class="el" href="group__convenience__fns.html#gada044cf02135422a9f9292b6054c86dd">apop_rng_alloc</a>, except the RNG it produces is kept for internal use. If you don't call it, then it will be called at first use, with seed zero.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">seed</td><td>The seed. No need to get funny with it: 0, 1, and 2 will produce wholly different streams. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>The RNG ready for your use. </dd></dl>

</div>
</div>
<a class="anchor" id="a01d501ca84ade92bc72fd4f67a617f64"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int apop_table_exists </td>
          <td>(</td>
          <td class="paramtype">char const *&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char&#160;</td>
          <td class="paramname"><em>remove</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Check for the existence of a table, and maybe delete it.</p>
<p>Recreating a table which already exists can cause errors, so it is good practice to check for existence first. Also, this is the stylish way to delete a table, since just calling <code>"drop table"</code> will give you an error if the table doesn't exist.</p>
<dl class="params"><dt>Parameters:</dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>the table name (no default) </td></tr>
    <tr><td class="paramname">remove</td><td>'d' ==&gt;delete table so it can be recreated in main.<br/>
 'n' ==&gt;no action. Return result so program can continue. (default) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns:</dt><dd>0 = table does not exist<br/>
 1 = table was found, and if remove=='d', has been deleted</dd></dl>
<ul>
<li>In the SQLite engine, this function considers table views to be tables.</li>
</ul>
<ul>
<li>If <code>apop_opts.stop_on_warn='n'</code>, returns -1 on errors.</li>
</ul>
<p>This function uses the <a class="el" href="designated.html">Designated initializers</a> syntax for inputs. </p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a7975faa07196cf463ec261ff0ddc3ccc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structapop__opts__type.html">apop_opts_type</a> apop_opts</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Initial value:</b><div class="fragment"><div class="line"> </div>
<div class="line">          { .verbose=1,                    .output_type = <span class="charliteral">&#39;f&#39;</span>,</div>
<div class="line">            .output_pipe = NULL,           .output_delimiter =<span class="stringliteral">&quot;\t&quot;</span>, </div>
<div class="line">            .output_append = 0,            .input_delimiters = <span class="stringliteral">&quot;|,\t&quot;</span>, </div>
<div class="line">            .db_name_column = <span class="stringliteral">&quot;row_names&quot;</span>, .db_nan = <span class="stringliteral">&quot;NaN&quot;</span>, </div>
<div class="line">            .db_engine = <span class="charliteral">&#39;\0&#39;</span>,             .db_user = <span class="stringliteral">&quot;\0&quot;</span>, </div>
<div class="line">            .db_pass = <span class="stringliteral">&quot;\0&quot;</span>,               .thread_count = 1,</div>
<div class="line">            .log_file = NULL,</div>
<div class="line">            .rng_seed = 479901,            .version = 0.99 }</div>
</div><!-- fragment --><p>Here are where the options are initially set. See the <a class="el" href="structapop__opts__type.html">apop_opts_type</a> documentation for details. </p>

</div>
</div>
</div><!-- contents -->
<p><p>
<div class="tiny">Autogenerated by doxygen on Mon Oct 8 2012.</div></body></html>
